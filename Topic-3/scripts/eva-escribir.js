//var contadorSombras=0;

var Datos4 = {
    indiceAutoevaluacion: 0,
    preguntas: [
        {
            imagen: 'IB3V-M3_OPA29-A-01.png',
            texto:'tdhiignm',
            descripcionim:'Imagen que representa la media noche.',
            opciones: [
                {
                    contenido: "midnight"
                }
            ]
        },
        {
            imagen: 'IB3V-M3_OPA29-A-02.png',
            texto:'hatc',
            descripcionim:'Imagen de dos personas utilizando el chat.',
            opciones: [
                {
                    contenido: "chat"
                }
            ]
        },
        {
            imagen: 'IB3V-M3_OPA29-A-03.png',
            texto:'pngsri',
            descripcionim:'Imagen que representa la primavera.',
            opciones: [
                {
                    contenido: "spring"
                }
            ]
        },
        {
            imagen: 'IB3V-M3_OPA29-A-04.png',
            texto:'sediilk',
            descripcionim:'Imagen que representa no me gusta.',
            opciones: [
                {
                    contenido: "dislike"
                }
            ]
        },
        {
            imagen: 'IB3V-M3_OPA29-A-05.png',
            texto:'eeekwdn',
            descripcionim:'Imagen que representa el fin de semana.',
            opciones: [
                {
                    contenido: "weekend"
                }
            ]
        },
        {
            imagen: 'IB3V-M3_OPA29-A-06.png',
            texto:'aeth',
            descripcionim:'Imagen que representa odiar algo.',
            opciones: [
                {
                    contenido: "hate"
                }
            ]
        },
        {
            imagen: 'IB3V-M3_OPA29-A-07.png',
            texto:'giimsmwn',
            descripcionim:'Imagen de persona nadando.',
            opciones: [
                {
                    contenido: "swimming"
                }
            ]
        },
        {
            imagen: 'IB3V-M3_OPA29-A-08.png',
            texto:'elvo',
            descripcionim:'Imagen de un corazón.',
            opciones: [
                {
                    contenido: "love"
                }
            ]
        },
        {
            imagen: 'IB3V-M3_OPA29-A-09.png',
            texto:'gdnriiv',
            descripcionim:'Imagen de persona manejando.',
            opciones: [
                {
                    contenido: "driving"
                }
            ]
        },
        {
            imagen: 'IB3V-M3_OPA29-A-10.png',
            texto:'mashicrst',
            descripcionim:'Imagen que representa la navidad.',
            opciones: [
                {
                    contenido: "christmas"
                }
            ]
        }
    ],
    terminoEvaluacion: false
    };

    var Datos5 = {
    indiceAutoevaluacion: 0,
    preguntas: [
        {
            imagen: 'IB3V-M3_OPA29-B-01.png',
            texto:'truuno',
            descripcionim:'Imagen que representa la acción de vaciar.',
            opciones: [
                {
                    contenido: "run out"
                }
            ]
        },
        {
            imagen: 'IB3V-M3_OPA29-B-02.png',
            texto:'ngteo',
            descripcionim:'Imagen que representa subirse.',
            opciones: [
                {
                    contenido: "get on"
                }
            ]
        },
        {
            imagen: 'IB3V-M3_OPA29-B-03.png',
            texto:'anufrrfe',
            descripcionim:'Imagen que representa correr tras algo.',
            opciones: [
                {
                    contenido: "run after"
                }
            ]
        },
        {
            imagen: 'IB3V-M3_OPA29-B-04.png',
            texto:'oaeuttk',
            descripcionim:'Imagen que representa la acción de sacar.',
            opciones: [
                {
                    contenido: "take out"
                }
            ]
        },
        {
            imagen: 'IB3V-M3_OPA29-B-05.png',
            texto:'lpuitf',
            descripcionim:'Imagen que representa la acción de levantar.',
            opciones: [
                {
                    contenido: "lift up"
                }
            ]
        },
        {
            imagen: 'IB3V-M3_OPA29-B-06.png',
            texto:'kotucki',
            descripcionim:'Imagen que representa la acción de echar.',
            opciones: [
                {
                    contenido: "kick out"
                }
            ]
        },
        {
            imagen: 'IB3V-M3_OPA29-B-07.png',
            texto:'kgcoab',
            descripcionim:'Imagen que representa la acción de regresar.',
            opciones: [
                {
                    contenido: "go back"
                }
            ]
        },
        {
            imagen: 'IB3V-M3_OPA29-B-08.png',
            texto:'nutrnon',
            descripcionim:'Imagen que representa la acción de encender.',
            opciones: [
                {
                    contenido: "turn on"
                }
            ]
        },
        {
            imagen: 'IB3V-M3_OPA29-B-09.png',
            texto:'cooutem',
            descripcionim:'Imagen que representa la acción de salir.',
            opciones: [
                {
                    contenido: "come out"
                }
            ]
        }
        
    ],
    terminoEvaluacion: false
    };


    var Datos6 = {
    indiceAutoevaluacion: 0,
    preguntas: [
        {
            imagen: 'IB3V-M3_OPA29-C-02.png',
            texto:'kcchaesch',
            descripcionim:'Imagen de persona cobrando un cheque.',
            opciones: [
                {
                    contenido: "cash a check"
                }
            ]
        },
        {
            imagen: 'IB3V-M3_OPA29-C-02.png',
            texto:'harcs',
            descripcionim:'Imagen de dos autos chocando.',
            opciones: [
                {
                    contenido: "crash"
                }
            ]
        },
        {
            imagen: 'IB3V-M3_OPA29-C-03.png',
            texto:'roeudtrof',
            descripcionim:'Imagen que representa algo descompuesto.',
            opciones: [
                {
                    contenido: "out of order"
                }
            ]
        },
        {
            imagen: 'IB3V-M3_OPA29-C-04.png',
            texto:'aeeblt',
            descripcionim:'Imagen de persona llegando tarde.',
            opciones: [
                {
                    contenido: "be late"
                }
            ]
        },
        {
            imagen: 'IB3V-M3_OPA29-C-05.png',
            texto:'arwnyua',
            descripcionim:'Imagen de una persona huyendo.',
            opciones: [
                {
                    contenido: "run away"
                }
            ]
        },
        {
            imagen: 'IB3V-M3_OPA29-C-06.png',
            texto:'rvaeri',
            descripcionim:'Imagen de un barco llegando.',
            opciones: [
                {
                    contenido: "arrive"
                }
            ]
        }
        
    ],
    terminoEvaluacion: false
    };

function quizescribir(activity) {
    //console.log("volvi");
    setTimeout(function() {
        $("."+activity).html("");
        var contenedorPrin = "."+activity;

        if(activity=="evaluacionfinal4"){
            var Datos = Datos4;
            var difer=4;
        }

        if(activity=="evaluacionfinal5"){
            var Datos = Datos5;
            var difer=5;
        }

        if(activity=="evaluacionfinal6"){
            var Datos = Datos6;
            var difer=6;
        }

        var totalQuest = Datos.preguntas.length;
        numPreg = 0,
        numResp = 0,
        respuestas = new Array();

        $(".evaluacionfinal"+difer).attr("data-resultado",0).attr("data-total",totalQuest);

        var $gral = $("<div>");
        var $slides = $("<div>");

        for (var i = 0; i < totalQuest; i++) {
            var $slide = $("<div>", { id: "pregunta-"+difer + i, class: "preguntas-separ" });
        
            if (i < totalQuest) {
                
                $slide.append("<div class='numeracion'><p><span class='sr-only'>Pregunta </span>" + (i + 1) + "</p></div>");

                var $contenedorPreg = $("<div>", { "class": "contenedor-preg" });

                $contenedorPreg.append("<img src='topic-3/img/content/" + Datos.preguntas[i].imagen + "' alt='"+Datos.preguntas[i].descripcionim+"'>");
                
                $contenedorPreg.append("<p class=''>" + Datos.preguntas[i].texto + "</p>");
                
                $slide.append($contenedorPreg);

                var $contenedorOpc = $("<div>", { "class": "contenedor-opciones item-input-" + i  });
                
                for (var j = 0; j < Datos.preguntas[i].opciones.length; j++) {
                    
                    $resp = $("<div>", {
                        "class": ""
                    }).data({
                        "numPreg": i
                    });

                    //for(var k = 0; k < inputs.length; k++) {
                    $resp.append("<input class='inputs-movil form-control' size="+Datos.preguntas[i].opciones[0].contenido.length+" data-activity="+activity+" data-valor='"+i+"' placeholder='Write here...'/>")    
                    //}

                    $resp.append("<p class='pastexto' ></p>");

                    $contenedorOpc.append($resp);
                }
                $slide.append($contenedorOpc);

                

            }
            $slides.append($slide);

        }



        $gral.append($slides);

        var $botones = $("<div>", {
                    "class": "botones" });
                var $boton1 = $("<button>", {
                    "class": "byc btn try control btn-right-"+i , "data-valor":i, "data-difer":difer, "disabled":true
                }).append("Try again").click(function () {
                    quizescribir(activity);
                });
                var $boton2 = $("<button>", {
                    "class": "check btn control btn-left-"+i , "data-valor":i, "data-difer":difer
                }).append("Check");
                $botones.append($boton2, $boton1);

                $gral.append('<div class="retroalimentacion1 rojoretro">&nbsp;</div>');
                $gral.append($botones);

        $("."+activity).append($gral);

        $(contenedorPrin + ' .check').click(function() {

            var malEscribir31=0;
            var difer=$(this).attr('data-difer');
            var numPreg=0;

            $(this).removeClass("activo");
           
            var resp="";
            $(contenedorPrin + " input").each(function(i) {
                numPreg = $(this).parent().data('numPreg');
                resp= $(this).val().trim();
                var arregloResp = Datos.preguntas[numPreg].opciones[0].contenido;
                var contestada = 0;
                if (contestada == 0) {
                    //console.log(normalize(arregloResp).toLowerCase() +" == "+ normalize(resp).toLowerCase());
                    if (normalize(arregloResp).toLowerCase() == normalize(resp).toLowerCase()) {
                        contestada = 1;
                    }
                }

                if (contestada == 1) {
                    //console.log("#pregunta-"+difer + numPreg );
                    $(contenedorPrin + " #pregunta-"+difer + numPreg + " div").addClass("inter-correcto selecs");
                    $(contenedorPrin + " #pregunta-"+difer + numPreg + " input").addClass("invisible");
                    
                    $(contenedorPrin + " #pregunta-"+difer + numPreg + " .pastexto").html(resp).append("<span class='sr-only'> correct! </span><i class='fa-solid fa-check' aria-hidden='true'></i>");
                    
                    
                } else {
                    $(contenedorPrin + " #pregunta-"+difer + numPreg + " div").addClass("inter-incorrecto");
                    $(contenedorPrin + " #pregunta-"+difer + numPreg + " input").addClass("invisible");
                    malEscribir31++;
                    $(contenedorPrin + " #pregunta-"+difer + numPreg + " .pastexto").html(resp).append("<span class='sr-only'> incorrect! </span><i class='fa-solid fa-xmark' aria-hidden='true'></i>");
                }
            });

            if (malEscribir31==0){
                $(contenedorPrin + " .retroalimentacion1").removeClass("rojoretro");
                $(contenedorPrin + " .retroalimentacion1").addClass("verderetro");
                $(contenedorPrin + " .retroalimentacion1").html("Very good! You are ready to continue.");
            }
            else{
                $(contenedorPrin + " .try").addClass("activo").removeClass("byc").attr("disabled",false);
                $(contenedorPrin + " .retroalimentacion1").addClass("rojoretro");
                $(contenedorPrin + " .retroalimentacion1").html("Try to answer the exercise again.");
            }
        });

        $(".inputs-movil").keyup(function() {
            recurso = $(this).attr('data-valor');
            act = $(this).attr('data-activity');
            formularioCompleto = true;

            $("."+act +" input").each(function() {
            
                if($(this).val().length <= 0 ){
                    formularioCompleto = false;
                }

            });

            if (formularioCompleto) {
                $("."+act +" .check").addClass('activo');
            }
            
        });

    }, 200);

}

var normalize = (function() {
    var from = "ÃÀÁÄÂÈÉËÊÌÍÏÎÒÓÖÔÙÚÜÛãàáäâèéëêìíïîòóöôùúüûÇç",
        to = "AAAAAEEEEIIIIOOOOUUUUaaaaaeeeeiiiioooouuuucc",
        mapping = {};
    for (var i = 0, j = from.length; i < j; i++)
        mapping[from.charAt(i)] = to.charAt(i);
    return function(str) {
        var ret = [];
        for (var i = 0, j = str.length; i < j; i++) {
            var c = str.charAt(i);
            if (mapping.hasOwnProperty(str.charAt(i)))
                ret.push(mapping[c]);
            else
                ret.push(c);
        }
        return ret.join('');
    }
})();